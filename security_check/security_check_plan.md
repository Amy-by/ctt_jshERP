# jshERP项目安全性检查计划

## 1. 项目信息收集与分析

### 1.1 项目基本信息
- **项目名称**：jshERP（管伊佳ERP）
- **技术栈**：
  - 后端：SpringBoot 2.0.0 + MyBatis 1.3.2 + Maven 3.3.9
  - 前端：Vue 2.7.16 + Ant-Design-Vue 1.5.2 + Jeecg-Boot 2.2.0
  - 数据库：MySQL 8.0.24
  - 缓存：Redis 6.2.1
  - 代理：Nginx 1.12.2

### 1.2 项目结构
```
ctt_jshERP/
├── jshERP-boot/    # 后端代码
├── jshERP-web/     # 前端代码
├── docker-compose.yml
└── README.md
```

## 2. 代码层面安全检查

### 2.1 敏感信息泄露检查
- **检查目标**：识别代码中硬编码的敏感信息
- **检查方法**：
  - 使用`grep`搜索代码中的敏感关键词：`password`, `key`, `secret`, `token`, `url`, `endpoint`等
  - 检查配置文件中的默认密码和密钥
  - 检查日志输出中是否包含敏感信息
- **检查范围**：
  - 后端：所有Java文件、配置文件（application.yml, application.properties等）
  - 前端：所有Vue文件、配置文件（.env, vue.config.js等）

### 2.2 后门与隐藏功能检查
- **检查目标**：识别代码中隐藏的管理接口或后门
- **检查方法**：
  - 使用`grep`搜索可疑函数调用：`exec()`, `system()`, `Runtime.getRuntime().exec()`等
  - 检查所有Controller类，识别未授权的接口
  - 检查所有Filter和Interceptor，识别异常的访问控制
  - 检查定时任务，识别异常的数据处理逻辑
- **检查范围**：
  - 后端：所有Controller、Filter、Interceptor、定时任务
  - 前端：所有API调用

### 2.3 数据收集机制检查
- **检查目标**：识别代码中向外部服务器发送数据的机制
- **检查方法**：
  - 使用`grep`搜索HTTP请求相关代码：`RestTemplate`, `HttpClient`, `axios`, `fetch`等
  - 检查前端埋点代码
  - 检查后端数据上报逻辑
- **重点关注**：是否存在向开源者服务器（如cloud.gyjerp.com）发送数据的机制
- **检查范围**：
  - 后端：所有HTTP请求代码
  - 前端：所有API调用和埋点代码

### 2.4 输入验证与输出编码检查
- **检查目标**：识别缺少输入验证和输出编码的代码
- **检查方法**：
  - 使用`grep`搜索SQL语句，识别SQL注入风险
  - 检查前端表单验证逻辑
  - 检查后端接口参数验证
  - 检查前端输出编码，识别XSS风险
- **检查范围**：
  - 后端：所有Controller接口、Service层方法
  - 前端：所有表单提交逻辑和输出渲染

### 2.5 认证与授权机制检查
- **检查目标**：确保认证和授权机制的安全性
- **检查方法**：
  - 检查JWT令牌的实现（如果使用）
  - 检查权限管理的实现
  - 检查会话管理的安全性
- **检查范围**：
  - 后端：Spring Security配置、认证授权相关代码
  - 前端：登录逻辑、权限控制逻辑

### 2.6 错误处理与信息泄露检查
- **检查目标**：确保错误处理不会泄露敏感信息
- **检查方法**：
  - 检查异常处理机制
  - 检查错误页面设计
  - 检查日志中的错误信息
- **检查范围**：
  - 后端：全局异常处理、控制器异常处理
  - 前端：错误提示设计

### 2.7 文件上传与下载安全检查
- **检查目标**：确保文件上传和下载的安全性
- **检查方法**：
  - 检查文件上传的验证和限制
  - 检查文件下载的权限控制
  - 检查文件存储的安全性
- **检查范围**：
  - 后端：文件处理相关代码
  - 前端：文件上传下载组件

## 3. 依赖项安全检查

### 3.1 后端依赖安全检查
- **检查目标**：识别后端依赖中的已知漏洞
- **检查方法**：
  - 运行`mvn dependency:tree`生成依赖树
  - 运行`mvn dependency-check:check`检查依赖漏洞
  - 检查结果分析
- **检查范围**：jshERP-boot/pom.xml

### 3.2 前端依赖安全检查
- **检查目标**：识别前端依赖中的已知漏洞
- **检查方法**：
  - 运行`npm audit`检查前端依赖漏洞
  - 检查结果分析
- **检查范围**：jshERP-web/package.json

## 4. 配置文件安全检查

### 4.1 数据库配置检查
- **检查目标**：确保数据库连接安全
- **检查内容**：
  - 数据库连接URL是否配置了加密连接（SSL）
  - 是否使用了强密码
  - 是否配置了适当的数据库用户权限
  - 数据库备份策略

### 4.2 密钥配置检查
- **检查目标**：确保密钥配置安全
- **检查内容**：
  - 是否使用了默认密钥
  - 是否配置了适当的密钥管理机制
  - 密钥是否足够复杂
  - 加密算法的安全性

### 4.3 外部服务配置检查
- **检查目标**：识别向外部服务发送数据的配置
- **检查内容**：
  - 外部服务URL配置
  - 数据上报配置
  - 第三方集成配置

### 4.4 安全配置检查
- **检查目标**：确保安全相关配置正确
- **检查内容**：
  - CORS配置
  - CSRF防护配置
  - 安全头配置
  - 会话管理配置
  - HTTPS配置

### 4.5 Redis配置检查
- **检查目标**：确保Redis配置安全
- **检查内容**：
  - 密码配置
  - 绑定地址配置
  - 端口配置
  - 数据持久化配置

### 4.6 Nginx配置检查
- **检查目标**：确保Nginx配置安全
- **检查内容**：
  - SSL配置
  - 安全头配置
  - 访问控制配置
  - 反向代理配置

## 5. 数据安全检查

### 5.1 数据传输加密检查
- **检查目标**：确保数据传输过程中的安全性
- **检查方法**：
  - 检查HTTPS配置
  - 检查WebSocket加密配置
- **检查范围**：
  - 后端：SSL配置
  - 前端：API调用协议

### 5.2 数据存储加密检查
- **检查目标**：确保敏感数据存储的安全性
- **检查方法**：
  - 检查密码加密实现
  - 检查敏感数据（如财务数据）的加密存储
- **检查范围**：
  - 后端：数据加密相关代码

### 5.3 数据库安全检查
- **检查目标**：确保数据库访问的安全性
- **检查方法**：
  - 检查SQL注入防护机制
  - 检查数据库访问权限
  - 检查数据库审计配置
- **检查范围**：
  - 后端：数据库访问相关代码

## 6. 日志安全检查

### 6.1 日志内容安全检查
- **检查目标**：确保日志中不包含敏感信息
- **检查方法**：
  - 检查日志输出格式
  - 检查日志中的数据
- **检查范围**：
  - 后端：日志配置、日志输出代码
  - 前端：控制台日志

### 6.2 日志访问控制检查
- **检查目标**：确保日志的访问安全
- **检查方法**：
  - 检查日志文件的权限
  - 检查日志系统的访问控制
- **检查范围**：
  - 后端：日志配置

## 7. 业务逻辑安全检查

### 7.1 业务流程安全检查
- **检查目标**：确保业务流程的安全性
- **检查方法**：
  - 检查业务流程中的权限控制
  - 检查数据一致性和完整性保护
  - 检查防止业务逻辑漏洞（如越权访问、重复提交等）
- **检查范围**：
  - 后端：业务逻辑相关代码
  - 前端：业务流程实现

### 7.2 财务数据安全检查
- **检查目标**：确保财务数据的安全性
- **检查方法**：
  - 检查财务数据的访问权限
  - 检查财务数据的审计机制
  - 检查财务操作的日志记录
- **检查范围**：
  - 后端：财务相关代码

## 8. 漏洞扫描

### 8.1 静态代码扫描
- **检查目标**：使用静态代码分析工具识别潜在漏洞
- **检查工具**：SonarQube, FindSecBugs等
- **检查范围**：后端Java代码

### 8.2 动态应用扫描
- **检查目标**：使用动态应用扫描工具识别运行时漏洞
- **检查工具**：OWASP ZAP, Burp Suite等
- **检查范围**：部署后的应用

## 9. 本地运行环境搭建

### 9.1 环境准备
- **所需工具**：
  - JDK 1.8
  - MySQL 8.0.24
  - Redis 6.2.1
  - Node 20.17.0
  - Maven 3.3.9
  - Nginx 1.12.2

### 9.2 环境搭建步骤
- **步骤1**：安装JDK 1.8并配置环境变量
- **步骤2**：安装MySQL 8.0.24，创建数据库，导入初始化SQL脚本
- **步骤3**：安装Redis 6.2.1并配置密码
- **步骤4**：安装Node 20.17.0和npm
- **步骤5**：安装Maven 3.3.9并配置环境变量
- **步骤6**：安装Nginx 1.12.2

### 9.3 项目编译与运行
- **后端编译与运行**：
  1. 进入jshERP-boot目录
  2. 修改application.yml配置文件，配置数据库连接、Redis连接等
  3. 运行`mvn clean package -DskipTests`编译项目
  4. 运行`java -jar target/jshERP-boot.jar`启动后端服务

- **前端编译与运行**：
  1. 进入jshERP-web目录
  2. 运行`npm install`安装依赖
  3. 修改配置文件，配置后端API地址
  4. 运行`npm run build`编译项目
  5. 将编译后的dist目录部署到Nginx

- **验证服务**：
  1. 前端：访问Nginx配置的地址
  2. 后端：访问`http://localhost:9999`
  3. 登录系统验证，默认租户账号：jsh，默认超管账户：admin，默认密码均为：123456

## 10. 实施步骤

1. **代码敏感信息搜索**：使用`grep`命令搜索代码中的敏感信息
2. **后门与数据收集机制检查**：使用`grep`命令搜索可疑代码
3. **认证与授权机制检查**：分析认证授权相关代码
4. **输入验证与输出编码检查**：检查输入验证和输出编码实现
5. **错误处理与信息泄露检查**：分析错误处理机制
6. **文件上传与下载安全检查**：检查文件处理相关代码
7. **依赖项安全检查**：分别在jshERP-boot和jshERP-web目录下运行依赖检查命令
8. **配置文件安全检查**：使用`grep`命令搜索配置文件中的敏感信息
9. **数据安全检查**：分析数据传输和存储加密机制
10. **日志安全检查**：检查日志配置和内容
11. **业务逻辑安全检查**：分析业务流程中的安全机制
12. **静态代码扫描**：使用SonarQube等工具进行静态代码分析
13. **动态应用扫描**：使用OWASP ZAP等工具进行动态应用扫描
14. **漏洞分析与报告生成**：分析扫描结果，生成安全检查报告

## 11. 预期输出

- 代码敏感信息搜索报告
- 后门与数据收集机制检查报告
- 认证与授权机制检查报告
- 输入验证与输出编码检查报告
- 错误处理与信息泄露检查报告
- 文件上传与下载安全检查报告
- 后端依赖漏洞报告
- 前端依赖漏洞报告
- 配置文件安全检查报告
- 数据安全检查报告
- 日志安全检查报告
- 业务逻辑安全检查报告
- 静态代码扫描报告
- 动态应用扫描报告
- 综合安全检查报告（包含发现的问题和修复建议）

## 12. 工具准备

### 12.1 命令行工具
- `grep`：用于代码搜索
- `mvn`：用于后端依赖检查
- `npm`：用于前端依赖检查

### 12.2 静态代码分析工具
- SonarQube：用于Java代码静态分析
- FindSecBugs：用于Java代码安全漏洞扫描

### 12.3 动态应用扫描工具
- OWASP ZAP：用于Web应用动态扫描
- Burp Suite：用于Web应用渗透测试

## 13. 注意事项

- 所有检查均在命令行中完成
- 重点关注代码中是否存在向开源者服务器（如cloud.gyjerp.com）发送数据的机制
- 检查结果将以报告形式呈现，包含发现的安全问题和修复建议
- 对于发现的高风险漏洞，将提供详细的修复方案
- 检查过程中严格遵守法律法规，仅对授权的代码进行安全检查
- 保护好检查过程中获取的敏感信息，避免二次泄露