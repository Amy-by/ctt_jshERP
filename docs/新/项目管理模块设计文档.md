# 项目管理模块设计文档

## 1. 系统架构

### 1.1 技术栈
- 后端：Java Spring Boot
- 前端：Vue.js
- 数据库：MySQL
- 缓存：Redis（可选）
- 认证：JWT

### 1.2 模块结构

#### 1.2.1 后端模块
- `com.jsh.erp.controller`：控制器层，处理HTTP请求
- `com.jsh.erp.service`：服务层，实现业务逻辑
- `com.jsh.erp.datasource.mappers`：数据访问层，处理数据库操作
- `com.jsh.erp.entity`：实体层，定义数据模型
- `com.jsh.erp.utils`：工具类

#### 1.2.2 前端模块
- `src/views/project`：项目管理相关页面
- `src/api/project`：API调用
- `src/components/project`：项目管理相关组件

## 2. 数据库设计

### 2.1 项目表（project）
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 项目ID |
| name | VARCHAR(255) | NOT NULL | 项目名称 |
| description | TEXT | | 项目描述 |
| manager_id | BIGINT | NOT NULL | 项目负责人ID |
| start_date | DATE | | 开始日期 |
| end_date | DATE | | 结束日期 |
| status | VARCHAR(50) | NOT NULL | 项目状态（计划中、进行中、已完成、已取消） |
| budget | DECIMAL(18,2) | | 项目预算 |
| priority | VARCHAR(50) | | 优先级（高、中、低） |
| progress | INT | DEFAULT 0 | 项目进度（0-100） |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |
| delete_flag | TINYINT | DEFAULT 0 | 删除标志（0：未删除，1：已删除） |

### 2.2 任务表（task）
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 任务ID |
| project_id | BIGINT | NOT NULL, FOREIGN KEY | 项目ID |
| name | VARCHAR(255) | NOT NULL | 任务名称 |
| description | TEXT | | 任务描述 |
| assignee_id | BIGINT | NOT NULL | 任务负责人ID |
| start_date | DATE | | 开始日期 |
| end_date | DATE | | 结束日期 |
| status | VARCHAR(50) | NOT NULL | 任务状态（待开始、进行中、已完成、已逾期） |
| priority | VARCHAR(50) | | 优先级（高、中、低） |
| progress | INT | DEFAULT 0 | 任务进度（0-100） |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |
| delete_flag | TINYINT | DEFAULT 0 | 删除标志（0：未删除，1：已删除） |

### 2.3 资源表（resource）
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 资源ID |
| name | VARCHAR(255) | NOT NULL | 资源名称 |
| type | VARCHAR(50) | NOT NULL | 资源类型（人力、设备、材料等） |
| available_quantity | INT | DEFAULT 0 | 可用数量 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |
| delete_flag | TINYINT | DEFAULT 0 | 删除标志（0：未删除，1：已删除） |

### 2.4 资源分配表（resource_allocation）
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 分配ID |
| project_id | BIGINT | FOREIGN KEY | 项目ID |
| task_id | BIGINT | FOREIGN KEY | 任务ID |
| resource_id | BIGINT | NOT NULL, FOREIGN KEY | 资源ID |
| quantity | INT | NOT NULL | 分配数量 |
| start_date | DATE | | 分配开始日期 |
| end_date | DATE | | 分配结束日期 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |

### 2.5 成本表（cost）
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 成本ID |
| project_id | BIGINT | NOT NULL, FOREIGN KEY | 项目ID |
| task_id | BIGINT | FOREIGN KEY | 任务ID |
| type | VARCHAR(50) | NOT NULL | 成本类型（人力、设备、材料等） |
| amount | DECIMAL(18,2) | NOT NULL | 成本金额 |
| occurrence_date | DATE | NOT NULL | 发生日期 |
| description | TEXT | | 成本描述 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |

### 2.6 文档表（document）
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 文档ID |
| project_id | BIGINT | NOT NULL, FOREIGN KEY | 项目ID |
| name | VARCHAR(255) | NOT NULL | 文档名称 |
| path | VARCHAR(500) | NOT NULL | 文档存储路径 |
| type | VARCHAR(50) | | 文档类型 |
| size | BIGINT | | 文档大小（字节） |
| upload_user_id | BIGINT | NOT NULL | 上传用户ID |
| upload_time | DATETIME | NOT NULL | 上传时间 |
| version | INT | DEFAULT 1 | 文档版本 |
| create_time | DATETIME | NOT NULL | 创建时间 |
| update_time | DATETIME | NOT NULL | 更新时间 |
| delete_flag | TINYINT | DEFAULT 0 | 删除标志（0：未删除，1：已删除） |

## 3. 后端设计

### 3.1 控制器设计

#### 3.1.1 项目控制器（ProjectController）
- `GET /api/project`：获取项目列表
- `GET /api/project/{id}`：获取项目详情
- `POST /api/project`：创建项目
- `PUT /api/project/{id}`：更新项目
- `DELETE /api/project/{id}`：删除项目
- `PUT /api/project/{id}/status`：更新项目状态
- `PUT /api/project/{id}/progress`：更新项目进度

#### 3.1.2 任务控制器（TaskController）
- `GET /api/task`：获取任务列表
- `GET /api/task/{id}`：获取任务详情
- `POST /api/task`：创建任务
- `PUT /api/task/{id}`：更新任务
- `DELETE /api/task/{id}`：删除任务
- `PUT /api/task/{id}/status`：更新任务状态
- `PUT /api/task/{id}/progress`：更新任务进度
- `GET /api/project/{projectId}/tasks`：获取项目的任务列表

#### 3.1.3 资源控制器（ResourceController）
- `GET /api/resource`：获取资源列表
- `GET /api/resource/{id}`：获取资源详情
- `POST /api/resource`：创建资源
- `PUT /api/resource/{id}`：更新资源
- `DELETE /api/resource/{id}`：删除资源

#### 3.1.4 资源分配控制器（ResourceAllocationController）
- `GET /api/resource-allocation`：获取资源分配列表
- `POST /api/resource-allocation`：创建资源分配
- `DELETE /api/resource-allocation/{id}`：删除资源分配
- `GET /api/project/{projectId}/resource-allocations`：获取项目的资源分配列表

#### 3.1.5 成本控制器（CostController）
- `GET /api/cost`：获取成本列表
- `GET /api/cost/{id}`：获取成本详情
- `POST /api/cost`：创建成本记录
- `PUT /api/cost/{id}`：更新成本记录
- `DELETE /api/cost/{id}`：删除成本记录
- `GET /api/project/{projectId}/costs`：获取项目的成本列表
- `GET /api/project/{projectId}/cost-summary`：获取项目的成本汇总

#### 3.1.6 文档控制器（DocumentController）
- `GET /api/document`：获取文档列表
- `GET /api/document/{id}`：获取文档详情
- `POST /api/document`：上传文档
- `DELETE /api/document/{id}`：删除文档
- `GET /api/document/{id}/download`：下载文档
- `GET /api/project/{projectId}/documents`：获取项目的文档列表

### 3.2 服务层设计

#### 3.2.1 项目服务（ProjectService）
- `List<Project> getProjectList(String keyword, String status, Long managerId, int pageNum, int pageSize)`：获取项目列表
- `Project getProjectById(Long id)`：获取项目详情
- `Long createProject(Project project)`：创建项目
- `int updateProject(Long id, Project project)`：更新项目
- `int deleteProject(Long id)`：删除项目
- `int updateProjectStatus(Long id, String status)`：更新项目状态
- `int updateProjectProgress(Long id, int progress)`：更新项目进度
- `int calculateProjectProgress(Long projectId)`：计算项目进度

#### 3.2.2 任务服务（TaskService）
- `List<Task> getTaskList(String keyword, String status, Long assigneeId, Long projectId, int pageNum, int pageSize)`：获取任务列表
- `Task getTaskById(Long id)`：获取任务详情
- `Long createTask(Task task)`：创建任务
- `int updateTask(Long id, Task task)`：更新任务
- `int deleteTask(Long id)`：删除任务
- `int updateTaskStatus(Long id, String status)`：更新任务状态
- `int updateTaskProgress(Long id, int progress)`：更新任务进度
- `List<Task> getTasksByProjectId(Long projectId)`：获取项目的任务列表

#### 3.2.3 资源服务（ResourceService）
- `List<Resource> getResourceList(String keyword, String type, int pageNum, int pageSize)`：获取资源列表
- `Resource getResourceById(Long id)`：获取资源详情
- `Long createResource(Resource resource)`：创建资源
- `int updateResource(Long id, Resource resource)`：更新资源
- `int deleteResource(Long id)`：删除资源

#### 3.2.4 资源分配服务（ResourceAllocationService）
- `List<ResourceAllocation> getResourceAllocationList(Long projectId, Long taskId, Long resourceId, int pageNum, int pageSize)`：获取资源分配列表
- `Long createResourceAllocation(ResourceAllocation allocation)`：创建资源分配
- `int deleteResourceAllocation(Long id)`：删除资源分配
- `List<ResourceAllocation> getResourceAllocationsByProjectId(Long projectId)`：获取项目的资源分配列表
- `boolean checkResourceConflict(Long resourceId, int quantity, Date startDate, Date endDate, Long excludeId)`：检查资源冲突

#### 3.2.5 成本服务（CostService）
- `List<Cost> getCostList(Long projectId, Long taskId, String type, Date startDate, Date endDate, int pageNum, int pageSize)`：获取成本列表
- `Cost getCostById(Long id)`：获取成本详情
- `Long createCost(Cost cost)`：创建成本记录
- `int updateCost(Long id, Cost cost)`：更新成本记录
- `int deleteCost(Long id)`：删除成本记录
- `List<Cost> getCostsByProjectId(Long projectId)`：获取项目的成本列表
- `Map<String, Object> getCostSummaryByProjectId(Long projectId)`：获取项目的成本汇总

#### 3.2.6 文档服务（DocumentService）
- `List<Document> getDocumentList(Long projectId, String type, int pageNum, int pageSize)`：获取文档列表
- `Document getDocumentById(Long id)`：获取文档详情
- `Long uploadDocument(MultipartFile file, Long projectId, Long userId)`：上传文档
- `int deleteDocument(Long id)`：删除文档
- `Resource getDocumentResource(Long id)`：获取文档资源（用于下载）
- `List<Document> getDocumentsByProjectId(Long projectId)`：获取项目的文档列表

### 3.3 数据访问层设计

#### 3.3.1 项目Mapper（ProjectMapper）
- `List<Project> selectByCondition(String keyword, String status, Long managerId, int offset, int limit)`：根据条件查询项目列表
- `Project selectByPrimaryKey(Long id)`：根据ID查询项目
- `int insert(Project project)`：插入项目
- `int updateByPrimaryKeySelective(Project project)`：更新项目
- `int deleteByPrimaryKey(Long id)`：删除项目

#### 3.3.2 任务Mapper（TaskMapper）
- `List<Task> selectByCondition(String keyword, String status, Long assigneeId, Long projectId, int offset, int limit)`：根据条件查询任务列表
- `Task selectByPrimaryKey(Long id)`：根据ID查询任务
- `int insert(Task task)`：插入任务
- `int updateByPrimaryKeySelective(Task task)`：更新任务
- `int deleteByPrimaryKey(Long id)`：删除任务
- `List<Task> selectByProjectId(Long projectId)`：根据项目ID查询任务列表

#### 3.3.3 资源Mapper（ResourceMapper）
- `List<Resource> selectByCondition(String keyword, String type, int offset, int limit)`：根据条件查询资源列表
- `Resource selectByPrimaryKey(Long id)`：根据ID查询资源
- `int insert(Resource resource)`：插入资源
- `int updateByPrimaryKeySelective(Resource resource)`：更新资源
- `int deleteByPrimaryKey(Long id)`：删除资源

#### 3.3.4 资源分配Mapper（ResourceAllocationMapper）
- `List<ResourceAllocation> selectByCondition(Long projectId, Long taskId, Long resourceId, int offset, int limit)`：根据条件查询资源分配列表
- `int insert(ResourceAllocation allocation)`：插入资源分配
- `int deleteByPrimaryKey(Long id)`：删除资源分配
- `List<ResourceAllocation> selectByProjectId(Long projectId)`：根据项目ID查询资源分配列表
- `List<ResourceAllocation> selectByResourceIdAndDateRange(Long resourceId, Date startDate, Date endDate, Long excludeId)`：根据资源ID和日期范围查询资源分配

#### 3.3.5 成本Mapper（CostMapper）
- `List<Cost> selectByCondition(Long projectId, Long taskId, String type, Date startDate, Date endDate, int offset, int limit)`：根据条件查询成本列表
- `Cost selectByPrimaryKey(Long id)`：根据ID查询成本
- `int insert(Cost cost)`：插入成本
- `int updateByPrimaryKeySelective(Cost cost)`：更新成本
- `int deleteByPrimaryKey(Long id)`：删除成本
- `List<Cost> selectByProjectId(Long projectId)`：根据项目ID查询成本列表
- `Map<String, Object> selectCostSummaryByProjectId(Long projectId)`：根据项目ID查询成本汇总

#### 3.3.6 文档Mapper（DocumentMapper）
- `List<Document> selectByCondition(Long projectId, String type, int offset, int limit)`：根据条件查询文档列表
- `Document selectByPrimaryKey(Long id)`：根据ID查询文档
- `int insert(Document document)`：插入文档
- `int updateByPrimaryKeySelective(Document document)`：更新文档
- `int deleteByPrimaryKey(Long id)`：删除文档
- `List<Document> selectByProjectId(Long projectId)`：根据项目ID查询文档列表

## 4. 前端设计

### 4.1 页面设计

#### 4.1.1 项目列表页
- 展示项目列表，支持分页、搜索、筛选
- 显示项目名称、负责人、状态、进度、开始/结束日期等信息
- 支持创建新项目、编辑项目、删除项目等操作

#### 4.1.2 项目详情页
- 展示项目基本信息
- 展示项目任务列表
- 展示项目资源分配情况
- 展示项目成本情况
- 展示项目文档列表
- 支持更新项目信息、状态、进度等

#### 4.1.3 任务列表页
- 展示任务列表，支持分页、搜索、筛选
- 显示任务名称、项目、负责人、状态、进度、开始/结束日期等信息
- 支持创建新任务、编辑任务、删除任务等操作

#### 4.1.4 任务详情页
- 展示任务基本信息
- 支持更新任务信息、状态、进度等

#### 4.1.5 资源管理页
- 展示资源列表，支持分页、搜索、筛选
- 显示资源名称、类型、可用数量等信息
- 支持创建新资源、编辑资源、删除资源等操作

#### 4.1.6 成本管理页
- 展示成本列表，支持分页、搜索、筛选
- 显示成本类型、金额、发生日期、项目/任务等信息
- 支持创建新成本记录、编辑成本记录、删除成本记录等操作
- 支持查看成本汇总报表

#### 4.1.7 文档管理页
- 展示文档列表，支持分页、搜索、筛选
- 显示文档名称、类型、大小、上传时间、上传人等信息
- 支持上传文档、下载文档、删除文档等操作

### 4.2 组件设计

#### 4.2.1 项目表单组件
- 用于创建和编辑项目
- 包含项目名称、描述、负责人、开始/结束日期、预算、优先级等字段

#### 4.2.2 任务表单组件
- 用于创建和编辑任务
- 包含任务名称、描述、负责人、开始/结束日期、优先级等字段

#### 4.2.3 进度组件
- 用于显示和更新项目/任务的进度
- 支持拖拽或输入方式更新进度

#### 4.2.4 甘特图组件
- 用于可视化展示项目和任务的时间线
- 支持查看和调整任务的开始/结束日期

#### 4.2.5 资源分配组件
- 用于分配资源给项目或任务
- 支持选择资源、设置分配数量和时间范围

#### 4.2.6 成本表单组件
- 用于创建和编辑成本记录
- 包含成本类型、金额、发生日期、描述等字段

#### 4.2.7 文档上传组件
- 用于上传项目相关文档
- 支持多文件上传、拖拽上传等功能

## 5. 接口设计

### 5.1 项目接口

#### 5.1.1 获取项目列表
- URL: `/api/project`
- Method: GET
- Parameters:
  - keyword: 搜索关键词
  - status: 项目状态
  - managerId: 负责人ID
  - pageNum: 页码
  - pageSize: 每页条数
- Response:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "list": [
        {
          "id": 1,
          "name": "项目A",
          "description": "项目A描述",
          "managerId": 1,
          "managerName": "张三",
          "startDate": "2026-01-01",
          "endDate": "2026-03-31",
          "status": "进行中",
          "budget": 100000.00,
          "priority": "高",
          "progress": 50,
          "createTime": "2026-01-01 00:00:00",
          "updateTime": "2026-01-15 00:00:00"
        }
      ],
      "total": 1
    }
  }
  ```

#### 5.1.2 创建项目
- URL: `/api/project`
- Method: POST
- Request Body:
  ```json
  {
    "name": "项目A",
    "description": "项目A描述",
    "managerId": 1,
    "startDate": "2026-01-01",
    "endDate": "2026-03-31",
    "status": "计划中",
    "budget": 100000.00,
    "priority": "高"
  }
  ```
- Response:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": 1
  }
  ```

### 5.2 任务接口

#### 5.2.1 获取任务列表
- URL: `/api/task`
- Method: GET
- Parameters:
  - keyword: 搜索关键词
  - status: 任务状态
  - assigneeId: 负责人ID
  - projectId: 项目ID
  - pageNum: 页码
  - pageSize: 每页条数
- Response:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "list": [
        {
          "id": 1,
          "projectId": 1,
          "projectName": "项目A",
          "name": "任务1",
          "description": "任务1描述",
          "assigneeId": 2,
          "assigneeName": "李四",
          "startDate": "2026-01-01",
          "endDate": "2026-01-15",
          "status": "进行中",
          "priority": "高",
          "progress": 70,
          "createTime": "2026-01-01 00:00:00",
          "updateTime": "2026-01-10 00:00:00"
        }
      ],
      "total": 1
    }
  }
  ```

#### 5.2.2 创建任务
- URL: `/api/task`
- Method: POST
- Request Body:
  ```json
  {
    "projectId": 1,
    "name": "任务1",
    "description": "任务1描述",
    "assigneeId": 2,
    "startDate": "2026-01-01",
    "endDate": "2026-01-15",
    "status": "待开始",
    "priority": "高"
  }
  ```
- Response:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": 1
  }
  ```

## 6. 实现计划

### 6.1 后端实现
1. 创建数据库表结构
2. 实现实体类（Entity）
3. 实现Mapper接口和XML配置
4. 实现Service层业务逻辑
5. 实现Controller层接口
6. 编写单元测试

### 6.2 前端实现
1. 创建项目管理相关页面
2. 实现页面组件和表单
3. 实现API调用
4. 实现页面交互逻辑
5. 测试和调试

### 6.3 集成测试
1. 测试后端接口
2. 测试前端页面
3. 测试前后端集成
4. 性能测试
5. 安全测试

## 7. 风险评估

### 7.1 技术风险
- 甘特图组件的实现复杂度较高，可能需要引入第三方库
- 资源冲突检测逻辑需要仔细设计，避免性能问题

### 7.2 业务风险
- 项目管理流程可能与企业现有流程存在差异，需要进行调整
- 数据迁移和历史数据处理可能需要额外工作

### 7.3 应对措施
- 采用成熟的甘特图库，如DHTMLX Gantt或Vue Gantt
- 优化资源冲突检测算法，使用索引和缓存提高性能
- 与业务部门充分沟通，了解现有流程，确保系统设计符合实际需求
- 制定详细的数据迁移计划，确保历史数据的完整性和准确性